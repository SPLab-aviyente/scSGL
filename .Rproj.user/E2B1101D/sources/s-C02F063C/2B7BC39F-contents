simulation_scLinkgraph.nc2.rho.0.1.b.1 <- read.csv("~/Documents/Documents/Summer_2019/scSGL/scSGL/simulation_scLinkgraph-nc2-rho-0.1-b-1.txt", sep="")
#Read real data
data<-simulation_scLinkgraph.nc2.rho.0.1.b.1
# “LogNormalize” that normalizes the gene expression measurements 
#for each cell by the total expression, multiplies by a scale factor of 10000,
#adds a value of 1 and log-transforms the result.
data_scaled<-apply(data,2,function(x) (x/sum(x))*10000)
data_logNormalized<-t(apply(data_scaled,2, log1p))
hist(data_logNormalized[1,][data_logNormalized[1,]!=0])
#Take a small subsample of data_logNormalized for ease of computation
data_logNormalized<-data_logNormalized[,1:10]
#n:number of cells
#p:number of genes
p<-10
n<-500
#iter: No of times surrogate data is generated
iter<-100
data_surrogate<-rep(list(matrix(NA,nrow=n,ncol=p)),length=iter)
cor_mat<-rep(list(matrix(NA,nrow=p,ncol=p)),length=iter)
for(i in 1:iter)
{
  #Create surrogate data by taking random samples
  data_surrogate[[i]]<-matrix(sample(data_logNormalized),ncol=p)
  #Calculate correlation matrix for surrogate data
  cor_mat[[i]]<-cor(data_surrogate[[i]],method = "kendall")
  diag(cor_mat[[i]])<-1
}
wa<-lapply(cor_mat,function(x) quantile(x[which(x !=1)], probs = c(0.25,0.75)))
quantile_25<-sapply(wa, `[[`, 1)
quantile_75<-sapply(wa, `[[`, 2)
quantile(quantile_25,probs = 0.50)
quantile(quantile_75,probs = 0.50)

